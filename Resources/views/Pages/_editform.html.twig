<!--=========Tabs=========-->
<ul class="nav nav-tabs">
    {% set alreadyexiststab = false %}
    {% for pagepartadmin in pagepartadmins %}
        {% set pagepartstab = 'pageparts'~loop.index %}

        {% if form['pagepartadmin_'~pagepartadmin.context] is defined %}
            {% set form_errors_recursive = alreadyexiststab ? form_errors_recursive([form['pagepartadmin_'~pagepartadmin.context]]) : form_errors_recursive([form.main, form.node, form.nodetranslation, form['pagepartadmin_'~pagepartadmin.context]]) %}
        {% else %}
            {% set form_errors_recursive = alreadyexiststab ? form_errors_recursive([]) : form_errors_recursive([form.main, form.node, form.nodetranslation]) %}
        {% endif %}

        {% set alreadyexiststab = true %}
        <li onClick="jQuery('#currenttab').val('pageparts{{ loop.index }}');" {% if currenttab == pagepartstab %} class="active" {% endif %}>
            <a href="#pageparts{{ loop.index }}" data-toggle="tab">
                {{ pagepartadmin.name }}
                {% if(form_errors_recursive|length > 0) %}
                    <span class="label label-important">{% if form_errors_recursive|length >1 %}{{form_errors_recursive|length}} {{ "Errors" | trans }}{% else %}{{ "1 Error" | trans }}{% endif %}</span>
                {% endif %}
            </a>
        </li>
    {% else %}
        {% set form_errors_recursive = form_errors_recursive([form.main, form.node, form.nodetranslation]) %}
        <li {% if currenttab == 'properties' or alreadyexiststab ==false %} class="active" {% endif %} onClick="jQuery('#currenttab').val('properties');">
            {% set alreadyexiststab = true %}
            <a href="#properties" data-toggle="tab">
                {{ 'Properties' | trans }}
                {% if(form_errors_recursive|length > 0) %}
                    <span class="label label-important">
                        {% if form_errors_recursive|length >1 %}
                            {{form_errors_recursive|length}} {{ "Errors" | trans }}
                        {% else %}
                            {{ "1 Error" | trans }}
                        {% endif %}
                    </span>
                {% endif %}
            </a>
        </li>
    {% endfor %}
    {% if is_granted('ROLE_PERMISSIONMANAGER') %}
        <li {% if currenttab == 'permissions' or alreadyexiststab == false %} class="active" {% endif %} onClick="jQuery('#currenttab').val('permissions');">
            {% set alreadyexiststab = true %}
            <a href="#permissions" data-toggle="tab">{{ 'form.permissions' | trans }}</a>
        </li>
    {% endif %}
    {% set form_errors_recursive = form_errors_recursive([form.seo]) %}
    <li {% if currenttab == 'seo' or alreadyexiststab ==false %} class="active" {% endif %} onClick="jQuery('#currenttab').val('seo');">
        <a href="#seo" data-toggle="tab">
            SEO
            {% if(form_errors_recursive|length > 0) %}
                <span class="label label-important">
                    {% if form_errors_recursive|length >1 %}
                        {{form_errors_recursive|length}} {{ "Errors" | trans }}
                    {% else %}
                        {{ "1 Error" | trans }}
                    {% endif %}
                </span>
            {% endif %}
        </a>
    </li>
</ul>

<div class="tab-content">
    <input type="hidden" name="currenttab" id="currenttab" value="{{ currenttab }}">
    {% for pagepartadmin in pagepartadmins %}
        {% set pagepartstab = 'pageparts'~loop.index %}

        <!--Tab-->
        <div class="{% if currenttab == pagepartstab %}active{% endif %} tab-pane" id="pageparts{{ loop.index }}">
            {% if loop.index == 1 %}
                <fieldset class="properties">
                    {{ form_widget(form.main) }}
                    {{ form_widget(form.node) }}
                    {{ form_widget(form.nodetranslation) }}
                </fieldset>
            {% endif %}
            {% if form['pagepartadmin_'~pagepartadmin.context] is defined %}
                {{ pagepartadmin_widget(pagepartadmin, form['pagepartadmin_'~pagepartadmin.context]) }}
            {% else %}
                {{ pagepartadmin_widget(pagepartadmin) }}
            {% endif %}
        </div>
        {% else %}
        <!--Tab-->
        <div class="{% if currenttab == 'properties' or pagepartstab is not defined %}active{% endif %} tab-pane" id="properties">
            <fieldset class="properties">
                <div class="input_prop">
                    {{ form_widget(form.main) }}
                </div>
                <div class="input_prop">
                    {{ form_widget(form.node) }}
                </div>
                <div class="input_prop">
                    {{ form_widget(form.nodetranslation) }}
                </div>
            </fieldset>
        </div>
    {% endfor %}

    {% if is_granted('ROLE_PERMISSIONMANAGER') and permissionadmin is defined %}
        <!--Tab-->
        <div class="{% if currenttab == 'permissions' %}active{% endif %} tab-pane" id="permissions">
            {{ permissionsadmin_widget(permissionadmin, form) }}
        </div>
    {% endif %}

    <!--Tab-->
    {% set seoform = form.seo %}
    <div class="{% if currenttab == 'seo' %}active{% endif %} tab-pane" id="seo">
        <fieldset class="properties">
            {{ form_row(seoform.metaAuthor) }}
            {{ form_row(seoform.metaDescription) }}
            {{ form_row(seoform.metaKeywords) }}
            {{ form_row(seoform.metaRobots) }}
            {{ form_row(seoform.metaRevised) }}
            {{ form_row(seoform.ogType) }}
            {{ form_row(seoform.ogTitle) }}
            {{ form_row(seoform.ogDescription) }}
            {{ form_row(seoform.ogImage) }}
            {{ form_row(seoform.extraMetadata) }}
            {{ form_row(seoform.cimKeyword) }}
        </fieldset>
        {{ form_rest(seoform) }}
    </div>
</div>
{{ form_rest(form) }}